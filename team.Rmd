---
title: "LAB5"
author: "Oztok"
date: "4/16/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#LOAD THE DATA and IMPORT
```{r}
library(dplyr)
library(ggplot2)
library(tidyr)
library(readr)
library(tidyverse)
library(lubridate)
library(readxl)
acc <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/accident.csv", stringsAsFactors = FALSE)
per <- read.csv("https://raw.githubusercontent.com/xdaiISU/ds202materials/master/hwlabs/fars2017/person.csv" , stringsAsFactors = FALSE)
```
<br>
<br>


#1 Are there some days of the week where more accidents happen than the others (see FARS manual, use variable DAY_WEEK)?
```{r}
table(acc$DAY_WEEK)
# As we can see no 7 has the highest value which corresponds to Saturday, then Sunday and Friday follows. We can generalize and say more accidents happen in weekends than weekdays.
```
<br>
<br>

#2 Create a data frame containing the persons who are fatally hurt in the accidents (look up variable INJ_SEV)
```{r}
fatally_hurt <- per %>% filter(INJ_SEV == 4)
```
<br>
<br>


#3 create a data frame containing the most dangerous vehicle make in each state. The number of persons fatally hit in the vehicle make is used to assess the (non-)safety of a make. Make sure to handle the missing values appropriately. (look up variable MAKE)
```{r}
newdata <- na.omit(per)
map(newdata, ~sum(is.na(.)))
most_dangerous <- newdata %>% filter(INJ_SEV == 4) %>% group_by(STATE) %>% count(MAKE)
most_dangerous <- most_dangerous  %>%
  group_by(STATE) %>%
  slice(which.max(n))
most_dangerous
```
<br>
<br>


#4 Create a map, and label each state with the most dangerous vehicle. Discuss the definition of the most dangerous vehicle, and what you find from the map. (Hint: Read the description for the STATE and COUNTY columns in the FARS manual. The state & county codes are Geographic Locator Codes (GLCs) from the General Services Administrationâ€™s (GSA) publication. Use readxl::read_xlsx to read in the GLCs.)
```{r}
```
<br>
<br>


#5 Join the accident and person table (work out which variable(s) to use)
```{r}
merged <- merge(acc, per)
```
<br>
<br>


#6 Tally the number of accidents by day of the week (DAY_WEEK), hour of the day (HOUR) and gender (SEX). Visualize the results and explain what you find.
```{r}
table(merged$DAY_WEEK)
table(merged$HOUR)
table(merged$SEX)
```
<br>
<br>


#7 Now plot a choropleth map of the number of deaths on a county level. Also explain what you find.
```{r}
```
<br>
<br>


#8 Is summer or winter more dangerous? Does this depend on states? Explore and explain.
```{r}
table(merged$MONTH)
hea <- merged %>% group_by(STATE) %>% count(MONTH)
hea <- hea %>%
  group_by(STATE) %>%
  slice(which.max(n))
hea
#Depends on the state
```
